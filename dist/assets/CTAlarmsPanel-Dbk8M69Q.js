import{r as c,j as a,C as A,a as y,b as N,B as C,c as T,T as b,d as v}from"./index-BKtIj6Cn.js";const E=()=>{const[m,x]=c.useState([]),[h,p]=c.useState(!0),[o,g]=c.useState(null),d=window.location.hostname,r=`${d==="localhost"||d.match(/^192\.168\./)?`http://${d}:1880/api`:"http://localhost:1880/api"}/ct/alarmas`,j=async()=>{try{p(!0),g(null),console.log("Sincronizando alarmas del CT...");try{await v.get(`${r}/sync`,{params:{_t:new Date().getTime()}}),console.log("Sincronización completada")}catch(s){console.warn("Error en sincronización, continuando con la obtención de datos:",s)}console.log("Obteniendo alarmas del CT desde:",r);const e=await v.get(r,{params:{_t:new Date().getTime()}});if(console.log("Respuesta de alarmas:",e.data),e.data&&e.data.success&&Array.isArray(e.data.data)&&e.data.data.length>0){const s=e.data.data[0],n=[];for(const[t,l]of Object.entries(s))if(t.startsWith("ct_defecto_")){const f=t.replace("ct_defecto_","").replace(/_/g," "),u=l===1||l===!0||l==="1"||l==="true";n.push({campo:t,mensaje:`Alarma: ${f}`,activa:u}),u&&console.log(`Alarma ACTIVA detectada: ${t} = ${l}`)}console.log(`Alarmas procesadas: ${n.length} total, ${n.filter(t=>t.activa).length} activas`),x(n)}else console.warn("No se encontraron datos de alarmas válidos:",e.data),x([])}catch(e){console.error("Error al cargar alarmas:",e),g("Error al cargar las alarmas del CT")}finally{p(!1)}};c.useEffect(()=>{console.log("Componente CTAlarmsPanel montado - URL:",r),j();const e=setInterval(()=>{console.log("Actualizando alarmas..."),j()},1e4);return()=>{console.log("Componente CTAlarmsPanel desmontado"),clearInterval(e)}},[r]);const i=m.filter(e=>e.activa);return a.jsxs(A,{children:[a.jsx(y,{children:a.jsxs(N,{className:"flex items-center justify-between",children:[a.jsx("span",{children:"Alarmas del Carro Transferidor"}),a.jsxs(C,{variant:"outline",className:"ml-2",children:[i.length," activas"]})]})}),a.jsxs(T,{children:[h&&a.jsx("div",{className:"text-center py-4",children:"Cargando alarmas..."}),o&&a.jsx("div",{className:"text-center py-4 text-red-500",children:o}),!h&&!o&&a.jsxs("div",{children:[i.length===0?a.jsx("div",{className:"text-center py-4 text-green-500",children:"No hay alarmas activas"}):a.jsx("div",{className:"space-y-2",children:i.map((e,s)=>a.jsxs("div",{className:"p-3 rounded-md flex items-start space-x-3 bg-red-50 text-red-600",children:[a.jsx("div",{className:"flex-shrink-0 pt-0.5",children:a.jsx(b,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium",children:e.mensaje}),a.jsx("p",{className:"text-xs text-gray-500",children:e.campo})]})]},s))}),a.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[a.jsx("h3",{className:"text-sm font-medium mb-2",children:"Todas las alarmas procesadas:"}),a.jsx("div",{className:"grid grid-cols-1 gap-1",children:m.map((e,s)=>a.jsxs("div",{className:`p-2 rounded-md text-xs ${e.activa?"bg-red-50 text-red-600":"bg-gray-50 text-gray-500"}`,children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"font-medium",children:e.campo}),a.jsx("span",{children:e.activa?"✓ ACTIVA":"✗ Inactiva"})]}),a.jsx("p",{children:e.mensaje})]},s))})]})]})]})]})};export{E as default};
